<!-- 内匹-反欺诈调查 -->
<template>
  <div class="aAntiFraudInvestigation RaAntiFraudInvestigation AlertDialogBox">
    <el-collapse v-model="activeNames" @change="handleChange">
      <el-collapse-item name="1">
        <template slot="title">
          <i class="collapse_title_icon"></i>
          <span class="collapse_title_text">基本信息</span>
        </template>
        <table class="table">
          <thead>
            <tr>
              <th  style="min-width:180px">进件编号</th>
              <th>案件编号</th>
              <th>客户姓名</th>
              <th  style="min-width:180px">身份证号</th>
              <th>申请产品</th>
              <th>进件机构</th>
              <th>销售人员</th>
              <th>提报人</th>
              <th>提报组别</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>{{fraudApplyInfo.applySubno}}</td>
              <td>{{fraudApplyInfo.caseNum}}</td>
              <td>{{fraudApplyInfo.applyCustName}}</td>
              <td>{{fraudApplyInfo.certCode}}</td>
              <td>{{fraudApplyInfo.proName}}</td>
              <td>{{fraudApplyInfo.operOrgName}}</td>
              <td>{{fraudApplyInfo.salePersonName}}</td>
              <td>{{fraudApplyInfo.applyPersonName}}</td>
              <td>{{fraudApplyInfo.appSuborgName}}</td>
            </tr>
          </tbody>
        </table>
      </el-collapse-item>
      <el-collapse-item name="2">
        <template slot="title">
          <i class="collapse_title_icon"></i>
          <span class="collapse_title_text">提报来源</span>
        </template>
        <div class="checkedInf checkedInf_li_width_triplet clearFix">
          <ul>
            <li>
              <label class="label_width_166">提报人工号：</label>
              <span>{{fraudApplyInfo.applyCode}}</span>
            </li>
            <li>
              <label class="label_width_166">提报人姓名：</label>
              <span>{{fraudApplyInfo.applyPersonName}}</span>
            </li>
            <li>
              <label class="label_width_166">提报渠道：</label>
              <span>{{fraudApplyInfo.channelTxt}}</span>
            </li>
            <li class="text_area_li triplet_textarea_width margin_top_5">
              <label class="label_width_166">理由：</label>
              <el-input class="text_area_li_3rows text_area_span_minus170" type="textarea" :rows="3" resize="none" v-model="reason" disabled>
              </el-input>
            </li>
          </ul>
        </div>
      </el-collapse-item>
      <el-collapse-item name="3">
        <template slot="title">
          <i class="collapse_title_icon"></i>
          <span class="collapse_title_text">命中规则</span>
        </template>
        <div class="height_auto">
          <el-table :data="hitRuleList" style="width: 100%" @cell-click="inquiry" border>
            <el-table-column type="index" :index='1' label="序号" min-width="50">
            </el-table-column>
            <el-table-column prop="ruleContent" label="命中规则名称" min-width="110">
            </el-table-column>
            <el-table-column prop="custCount" label="命中客户数" min-width="80">
            </el-table-column>
          </el-table>
        </div>
      </el-collapse-item>
      <el-collapse-item name="4">
        <template slot="title">
          <i class="collapse_title_icon"></i>
          <span class="collapse_title_text">调查记录</span>
        </template>
        <div class="checkedInf checkedInf_li_width_triplet clearFix">
          <ul>
            <li class="text_area_li triplet_textarea_width">
              <label class="label_width_166">网查：</label>
              <el-input class="text_area_li_3rows text_area_span_minus170" type="textarea" :rows="3" resize="none" v-model="fraudAuditInfo.netCheck"
                disabled>
              </el-input>
            </li>
            <li class="text_area_li triplet_textarea_width margin_top_5">
              <label class="label_width_166">114：</label>
              <el-input class="text_area_li_3rows text_area_span_minus170" type="textarea" :rows="3" resize="none" v-model="fraudAuditInfo.oof"
                disabled>
              </el-input>
            </li>
            <li class="text_area_li triplet_textarea_width margin_top_5">
              <label class="label_width_166">其他：</label>
              <el-input class="text_area_li_3rows text_area_span_minus170" type="textarea" :rows="3" resize="none" v-model="fraudAuditInfo.other"
                disabled>
              </el-input>
            </li>
          </ul>
        </div>
      </el-collapse-item>
      <el-collapse-item name="5">
        <template slot="title">
          <i class="collapse_title_icon"></i>
          <span class="collapse_title_text">电核区</span>
        </template>
        <div class="height_auto">
          <el-table :data="fraudTelCheckList" style="width: 100%" highlight-current-row border @current-change="handleCurrentChanges">
            <el-table-column type="index" :index='1' label="序号" width="50">
            </el-table-column>
            <el-table-column prop="name" label="姓名" width="120"></el-table-column>
            <el-table-column prop="phoneNum" label="手机号码" width="180">
            </el-table-column>
            <el-table-column prop="relation" label="关系" width="180">
            </el-table-column>
            <el-table-column prop="record" label="记录录入" min-width="150">
            </el-table-column>
          </el-table>
        </div>
      </el-collapse-item>
    </el-collapse>
    <!-- 弹框 -->
    <!-- <div class="numLog"> -->
    <el-dialog :title='aa' :visible.sync="dialogVisible" width="860px">
      <div class="numBody">
        <el-table ref="multipleTable" :data="recordList" style="width: 100%" height="250" border highlight-current-row @selection-change="handleSelectionChange">
          <el-table-column type="index" :index='1' label="序号" min-width="50">
          </el-table-column>
          <el-table-column type="selection" min-width="50">
          </el-table-column>
          <el-table-column label="进件编号" prop="applySubNo" min-width="120">
          </el-table-column>
          <el-table-column prop="ruleContent" label="命中客户名称" min-width="120">
          </el-table-column>
          <el-table-column prop="statusTxt" label="状态" min-width="80">
          </el-table-column>
          <el-table-column label="操作" min-width="50" fixed="right">
            <template slot-scope="scope">
              <el-button size="mini" @click="handlDetail(scope.$index, scope.row)">详情
              </el-button>
            </template>
          </el-table-column>
        </el-table>
        <!-- 分页 -->
        <div class="page">
          <el-pagination @size-change="handleSizeChange" @current-change="handleCurrentChange" :current-page="currentPage" :page-sizes="[10, 50, 80, 100]"
            :page-size=setPageSize layout="total, sizes, prev, pager, next, jumper" :total="totals.totalRecord">
          </el-pagination>
        </div>
      </div>
      <span slot="footer" class="dialog-footer">
        <el-button type="primary" @click="sure">确定</el-button>
      </span>
    </el-dialog>
    <!-- </div> -->
  </div>
</template>
<script type="text/javascript">
  export default {
    data() {
      return {
        aa: '命中规则名称：',
        activeNames: ['1', '2', '3', '4', '5'],
        fraudApplyInfo: '',
        hitRuleList: [],
        fraudTelCheckList: [],
        createTime: '',
        fraudAuditInfo: {
          "appinfoId": "", // 反欺诈申请id
          "netCheck": "", // 网查
          "oof": "", // 114
          "other": "", // 其他
          "auditCode": "", // 当前审核人编号
          "auditName": "" // 当前审核人姓名
        },
        dialogVisible: false,
        totals: {},
        currentPage: 1, // 默认显示的当前页
        setPageSize: 10,
        recordList: [],
        /*反欺诈申请ID*/
        appinfoId: '',
        /*命中规则列表参数*/
        ruleId: '',
        pageParam: {
          pageSize: 10,
          pageNum: 1
        },
        /*存放多选时选中的数据*/
        multipleSelection: [],
        //根据judgeFlag判断取 反欺诈专员 还是 反欺诈主管的申请ID
        judgeFlag: '',
        //理由：主原因+子原因+描述
        reason: '',
        //恢复、解除的新数组
        newArray: [],
        /*relations: [{
            'value': '01',
            'label': '夫妻'
          },
          {
            'value': '02',
            'label': '父母'
          },
          {
            'value': '03',
            'label': '子女'
          },
          {
            'value': '04',
            'label': '兄弟'
          },
          {
            'value': '05',
            'label': '姐妹'
          },
          {
            'value': '06',
            'label': '兄妹'
          },
          {
            'value': '07',
            'label': '姐弟'
          },
          {
            'value': '08',
            'label': '朋友'
          },
          {
            'value': '09',
            'label': '同事'
          },
          {
            'value': '10',
            'label': '房东'
          },
          {
            'value': '11',
            'label': '亲属'
          },
          {
            'value': '12',
            'label': '其他'
          },
          {
            'value': '13',
            'label': '本人'
          },
          {
            'value': '14',
            'label': '单位'
          }
        ],*/
      }
    },
    props: ['applyId', 'isShow'],
    mounted() {
      this.request(this.applyId);
    },
    methods: {
      /*先查询列表*/
      request(val) {
        this.post('antiFraud/getAntiFraudSurveyInfoByApplyId', {
          'applyId': val //'1',
        }).then(res => {
          if (res.statusCode == 200 && res.data != null) {
            //基本信息
            if (res.data.fraudApplyInfo == null) {
              this.fraudApplyInfo = this.fraudApplyInfo;
            } else {
              this.fraudApplyInfo = res.data.fraudApplyInfo;
              //提报来源  理由
              if (this.fraudApplyInfo.mainreaName == null && this.fraudApplyInfo.subreaName == null && this.fraudApplyInfo
                .applyDesc == null) {
                this.reason = '';
              } else {
                this.reason = this.fraudApplyInfo.mainreaName + this.fraudApplyInfo.subreaName + this.fraudApplyInfo
                  .applyDesc;
                var reg = /null/g;
                //var string = 'hdksjkdjnullfhdlfjl';
                this.reason = this.reason.replace(reg, '');
              };
            };
            //命中规则
            if (res.data.hitRuleList == null) {
              this.hitRuleList = this.hitRuleList;
            } else {
              this.hitRuleList = res.data.hitRuleList;
            };

            if (res.data.fraudAuditInfo == null) {
              this.fraudAuditInfo = this.fraudAuditInfo;
            } else {
              this.fraudAuditInfo = res.data.fraudAuditInfo;
            };
            //电核区
            if (res.data.fraudTelCheckList == null) {
              this.fraudTelCheckList = this.fraudTelCheckList;
            } else {
              this.fraudTelCheckList = res.data.fraudTelCheckList;
              for (var i = 0; i < this.fraudTelCheckList.length; i++) {
                this.createTime = this.fraudTelCheckList[i].createTime;
                if (this.fraudTelCheckList[i].relation == '01') {
                  this.fraudTelCheckList[i].relation = '夫妻';
                } else if (this.fraudTelCheckList[i].relation == '02') {
                  this.fraudTelCheckList[i].relation = '父母';
                } else if (this.fraudTelCheckList[i].relation == '03') {
                  this.fraudTelCheckList[i].relation = '子女';
                } else if (this.fraudTelCheckList[i].relation == '04') {
                  this.fraudTelCheckList[i].relation = '兄弟';
                } else if (this.fraudTelCheckList[i].relation == '05') {
                  this.fraudTelCheckList[i].relation = '姐妹';
                } else if (this.fraudTelCheckList[i].relation == '06') {
                  this.fraudTelCheckList[i].relation = '兄妹';
                } else if (this.fraudTelCheckList[i].relation == '07') {
                  this.fraudTelCheckList[i].relation = '姐弟';
                } else if (this.fraudTelCheckList[i].relation == '08') {
                  this.fraudTelCheckList[i].relation = '朋友';
                } else if (this.fraudTelCheckList[i].relation == '09') {
                  this.fraudTelCheckList[i].relation = '同事';
                } else if (this.fraudTelCheckList[i].relation == '10') {
                  this.fraudTelCheckList[i].relation = '房东';
                } else if (this.fraudTelCheckList[i].relation == '11') {
                  this.fraudTelCheckList[i].relation = '亲属';
                } else if (this.fraudTelCheckList[i].relation == '12') {
                  this.fraudTelCheckList[i].relation = '其他';
                } else if (this.fraudTelCheckList[i].relation == '13') {
                  this.fraudTelCheckList[i].relation = '本人';
                } else if (this.fraudTelCheckList[i].relation == '14') {
                  this.fraudTelCheckList[i].relation = '单位';
                }
              };
              for (var i = 0; i < this.fraudTelCheckList.legth; i++) {
                this.fraudTelCheckList[i].createTime = this.createTime;
              };
            };
          }
        })
      },
      handleChange() {

      },
      handleCurrentChanges(val) {
        if (val == null) {
          this.currentRow = '';
        } else {
          this.currentRow = val;
        };
      },
      sure() {
        this.dialogVisible = false;
      },
      handlDetail(index, row) {
        // this.$router.push({
        //   path: '/MatchingInfQuery'
        // });
        this.$router.push({
          name: 'MatchingInfQuery',
          params: {
            newOne: true,
          }
        });
        localStorage.setItem("Query", JSON.stringify({
          id: row.id,
          matchApplyId: row.applyId,
          applySubNo: row.applySubNo,
          isInterFlag: false
        }));
      },
      /*命中客户数 查询*/
      inquiry(row) {
        if (this.isShow == false) {
          return
        } else {
          if (row) {
            if (row.custCount == 0) {
              return
            }
          };

          this.dialogVisible = true;
          this.ruleId = row.ruleId;
          this.check(this.pageParam, this.ruleId);
        }

      },
      check(param, id) {
        this.post("antiFraud/getHitRuleCustList", {
          'pageParam': param,
          'ruleId': id
        }).then(res => {
          if (res.statusCode == 200) {
            this.totals = res.data;
            this.recordList = res.data.recordList;
          }
        })
      },
      /*分页*/
      handleSizeChange(val) {
        this.pageParam.pageSize = val;
        this.pageParam.pageNum = 1;
        if (this.currentPage !== 1 || this.setPageSize !== 10) {
          this.currentPage = 1;
          this.setPageSize = 10;
        } else {
          this.check(this.pageParam, this.ruleId);
        };
      },
      handleCurrentChange(val) {
        this.pageParam.pageNum = val;
        this.check(this.pageParam, this.ruleId);
      },
      /*多选框*/
      handleSelectionChange(val) {
        this.multipleSelection = val;
      },
    }
  }

</script>
<style type="text/css" scoped>
  .aAntiFraudInvestigation {
    min-width: 1327px;
    font-size: 14px;
    color: #475669;
  }

  /* 折叠面板头部背景色和icon */

  .icon_hat {
    padding: 9px 10px 10px 13px;
    vertical-align: middle;
  }

  .headFont {
    font-size: 16px;
  }

  .table {
    font-weight: 400;
    font-size: 14px;
    border: 1px solid #e6ebf5;
    border-collapse: collapse;
    width: 100%;
  }

  .table thead {
    width: 100%;
  }

  .table th {
    color: #1f2d3d;
    font-weight: 800;
    height:35px;
    line-height: 35px;
    border: 1px solid #e6ebf5;
    width: 11.1%;
    min-width: 147px;
  }

  .table td {
    color: #666;
    height: 30px;
    line-height: 30px;
    border: 1px solid #e6ebf5;
    width: 11.1%;
    min-width: 147px;
    text-align: left;
    padding-left: 10px;        
  }

  /* 提报来源 */

  .tibao {
    width: 100%;
  }

  .tibao ul {
    width: 100%;
    padding-left: 10px;        
    margin-top: 20px;
    height: 28px;
  }

  .tibao ul li {
    float: left;
    width: 33.3%;
    line-height: 28px;
  }

  .tibao ul li label {
    float: left;
    width: 150px;
    display: inline-block;
    text-align: right;
  }

  .tibao ul li p {
    float: left;
    width: 200px;
    display: inline-block;
    text-align: left;
  }

  .tibao div {
    width: 100%;
    padding-right: calc(66.6% - 350px);
    height: 75px;
    margin: 20px 0;
  }

  .tibao div label {
    width: 150px;
    text-align: right;
    display: inline-block;
    float: left;
    line-height: 75px;
  }

  .tibao div div {
    width: calc(100% - 150px);
    display: inline-block;
    padding-left: 0;
    padding-right: 0;
    margin: 0 0;
  }

  /* 命中规则 */

  .tableDiv {
    width: calc( 33.3% + 350px);
  }

  /* 调查记录 */

  .record ul li {
    width: 100%;
    padding-right: calc( 66.6% - 350px);
  }

  .record ul li label {
    width: 150px;
    display: inline-block;
    float: left;
    height: 75px;
    line-height: 75px;
    text-align: right;
    padding-top: 20px;
  }

  .record ul li div {
    width: calc( 100% - 150px);
    display: inline-block;
    margin-top: 20px;
  }

  /* 电核*/

  /* .ElectroNuclear {
    width: 100%;
    padding-right: calc( 66.6% - 350px);
  } */

  .left {
    float: left;
  }

  .right {
    float: right;
  }

  .right .rightSpans {
    margin-left: 10px;
    display: inline-block;
    width: 66px;
    height: 40px;
    float: left;
  }

  .right .rightSpans img {
    padding-top: 5px;
    float: left;
  }

  .right .rightSpans span {
    margin-left: 10px;
    float: left;
  }

  .right .rightSpans .icon {
    color: #20a0ff;
    font-size: 20px;
  }

  /* .right .rightSpan:nth-of-type(2) img, .right .rightSpan:nth-of-type(3) img{
		padding-left:24px;
	} */

  /* 确定按钮 */

  .button {
    width: 100%;
  }

  .button button {
    margin-right: calc( 66.6% - 350px);
    float: right;
    margin-top: 20px;
    margin-bottom: 20px;
    background-color: #409eff;
    border-color: #409eff;
  }

  /* 弹层 */

  .numBody .markIcon span {
    height: 30px;
    display: inline-block;
  }

  .numBody .markIcon span img {
    float: left;
  }

  .numBody .markIcon span span {
    height: 30px;
    line-height: 30px;
    float: left;
    padding: 0 5px;
    font-size: 14px;
  }

</style>
